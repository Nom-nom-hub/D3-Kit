---
description: Analyze D3 project artifacts for consistency, completeness, and adherence to D3-Kit principles.
handoffs:
  - label: Generate Quality Checklist
    agent: d3.checklist
    prompt: Create a detailed quality checklist based on this analysis
    send: true
  - label: Suggest Improvements
    agent: d3.clarify
    prompt: Identify areas that need clarification or improvement
    send: true
scripts:
  sh: scripts/bash/d3-analyze.sh --json
  ps: scripts/powershell/d3-analyze.ps1 -Json
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

The `/d3.analyze` command performs cross-artifact consistency & coverage analysis across the D3 feature, checking for alignment between idea, spec, plan, and tasks. This analysis runs after `/d3.tasks` and before `/d3.implement` to ensure consistency before implementation.

Given the current feature directory, do this:

1. **Setup**: Run `{SCRIPT}` from repo root and parse JSON for FEATURE_DIR, SPEC_FILE, PLAN_FILE, TASKS_FILE, and ANALYSIS_STATUS.

2. **Load all artifacts**: Read from FEATURE_DIR:
   - `spec.md`: Feature specification with developer intent and coding slices
   - `plan.md`: Technical implementation plan with architecture decisions
   - `tasks.md`: Actionable task list organized by coding slices
   - `research.md`: Technical research and decisions (if exists)
   - `data-model.md`: Entity definitions (if exists)
   - `contracts/`: API specifications (if exist)

3. **Execute consistency analysis**:

   a. **Intent-to-Implementation Traceability**:
      - Verify every coding slice in spec.md has corresponding tasks in tasks.md
      - Confirm developer intent from each slice is reflected in the plan
      - Check that all success criteria in spec.md can be verified through implementation

   b. **Specification Completeness**:
      - Verify no [CLARIFY] markers remain in spec.md or plan.md
      - Confirm all acceptance scenarios have corresponding implementation tasks
      - Ensure each coding slice is independently testable based on tasks

   c. **Plan-Artifact Alignment**:
      - Check that data models in data-model.md match requirements in spec.md
      - Verify API contracts align with functionality described in coding slices
      - Confirm technical choices in plan.md support developer intent

   d. **Task Completeness Analysis**:
      - Validate all required components have corresponding tasks
      - Check task dependencies are properly ordered
      - Identify missing tasks that would be needed for complete implementation
      - Verify parallelization opportunities are properly marked [P]

4. **D3-Kit Principles Compliance Check**:
   - Intent-First: Verify all elements trace back to original developer intent
   - Executable Specifications: Confirm spec can generate required implementation
   - Continuous Validation: Check that validation points are built into the process
   - Task-Oriented: Verify all work is broken into actionable tasks
   - Parallel Exploration: Identify missed opportunities for parallel development
   - Test-First: Confirm testing tasks are included where needed
   - No Speculation: Verify all items map to original requirements

5. **Generate analysis report** in `analysis-report.md` with:
   - Consistency findings (what aligns, what doesn't)
   - Completeness gaps (missing elements)
   - Traceability matrix (spec → plan → tasks → implementation)
   - D3-Kit principles compliance status
   - Recommendations for improvements

6. **Identify action items**:
   - Items that need clarification [CLARIFY]
   - Missing artifacts that should be created
   - Inconsistencies that need resolution
   - Opportunities for process improvement

7. **Report analysis results**: Output path to analysis report and summary of key findings:
   - Consistency score (percentage of elements that align)
   - Critical gaps identified
   - Recommendations for addressing inconsistencies
   - Readiness for implementation phase

## D3-Kit Analysis Focus Areas

- **Developer Intent Preservation**: Ensure intent flows consistently through all artifacts
- **Coding Slice Independence**: Verify each slice can be implemented independently
- **Parallelization Opportunities**: Identify where more parallel execution could be enabled
- **AI-Process Optimization**: Ensure all artifacts are structured for AI processing
- **Traceability**: Maintain clear links between idea, spec, plan, and tasks

## Key Guidelines

- Maintain focus on consistency across all D3 artifacts
- Identify gaps that could cause problems during implementation
- Verify that all work is traceable back to original developer intent
- Look for opportunities to improve the D3 process based on this analysis
- Ensure parallel development opportunities are properly identified and planned